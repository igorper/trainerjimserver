var exerciseTypesSelector = angular.module('exerciseTypes.selector', [
  'ui.select',
  'exerciseTypes.exerciseType',
  'exerciseGroups.exerciseGroup',
  'exerciseTypes.exerciseTypePanel',
  'toaster'
]);

exerciseTypesSelector.factory('ExerciseTypesSelector', ['$modal', function ($modal) {
  return function (options) {
    return $modal.open({
      templateUrl: '<%= asset_path('exerciseTypes/exercise-type-selector.html') %>',
      controller: ['$scope', '$modalInstance', 'ExerciseGroup', 'ExerciseType', function ($scope, $modalInstance, ExerciseGroup, ExerciseType) {
        $scope.exerciseGroups = ExerciseGroup.query();
        $scope.exerciseTypes = ExerciseType.query();

        options = angular.extend(
          {onAddExerciseType: $modalInstance.close},
          options
        );

        $scope.addedExcercisesCount = 0;
        $scope.editorUserId = options.editorUserId;
        $scope.isAdministrator = options.isAdministrator;

        $scope.onExerciseTypeClicked = function (exerciseType) {
          options.onAddExerciseType(exerciseType);
          ++$scope.addedExcercisesCount;
        };

        $scope.onExerciseTypeAddClicked = function () {
          console.log('onExerciseTypeAddClicked');

        };

        $scope.onExerciseTypeEditClicked = function (exerciseType) {
          console.log('onExerciseTypeEditClicked', exerciseType);

        };

        $scope.onExerciseTypeDeleteClicked = function (exerciseType) {
          console.log('onExerciseTypeDeleteClicked', exerciseType);
        };

        $scope.cancel = function () {
          if ($scope.addedExcercisesCount > 0) {
            $modalInstance.close({addedExercisesCount: $scope.addedExcercisesCount});
          } else {
            $modalInstance.dismiss();
          }
        };
      }
      ],
      backdrop: true,
      size: 'lg',
      windowClass: 'modal-window'
    });
  };
}]);