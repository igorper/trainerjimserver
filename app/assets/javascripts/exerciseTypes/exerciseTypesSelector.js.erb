//= require exerciseTypes/exerciseType

var exerciseTypesSelector = angular.module('exerciseTypes.selector', [
  'ui.select',
  'exerciseTypes.exerciseType',
  'exerciseTypes.exerciseTypePanel',
  'toaster'
]);

exerciseTypesSelector.factory('ExerciseTypesSelector', ['$modal', function ($modal) {
  return function (options) {
    return $modal.open({
      templateUrl: '<%= asset_path('exerciseTypes/exercise-type-selector.html') %>',
      controller: ["$scope", '$modalInstance',
        function ($scope, $modalInstance) {

          options = angular.extend(
            {onAddExerciseType: $modalInstance.close},
            options
          );

          $scope.addedExcercisesCount = 0;

          $scope.onExerciseTypeClicked = function (exerciseType) {
            options.onAddExerciseType(exerciseType);
              ++$scope.addedExcercisesCount;
          };

          $scope.cancel = function () {
            if ($scope.addedExcercisesCount > 0) {
              $modalInstance.close({addedExercisesCount: $scope.addedExcercisesCount});
            } else {
              $modalInstance.dismiss();
            }
          };
        }
      ],
      backdrop: 'static',
      size: 'lg',
      windowClass: 'modal-window'
    });
  };
}]);