//= require exerciseTypes/exerciseType
//= require exerciseTypes/exerciseTypeEditor

var exerciseTypeEditDialog = angular.module("exerciseTypes.exerciseTypeEditDialog", [
  'exerciseTypes.exerciseType',
  'exerciseTypes.exerciseTypeEditor',
  'angularSpinner'
]);

exerciseTypeEditDialog.factory('ExerciseTypeEditDialog', ['$modal', 'ExerciseType', 'usSpinnerService', 'toaster', function ($modal, ExerciseType, usSpinnerService, toaster) {
  return function (exerciseType) {
    return $modal.open({
      templateUrl: '<%= asset_path('exerciseTypes/exercise-type-edit-dialog.html') %>',
      backdrop: 'static',
      windowClass: 'modal-window',
      controller: ['$scope', '$modalInstance',
        function ($scope, $modalInstance) {
          $scope.exerciseType = exerciseType ? exerciseType : new ExerciseType();

          function stopSpinner() {
            usSpinnerService.stop('exercise-upload-spinner');
          }

          function showUploadExerciseTypeError() {
            stopSpinner();
            toaster.pop("error", "Exercise type not uploaded", "An error occurred while uploading the exercise type.");
          }

          function closeDialogWithResult() {
            stopSpinner();
            $modalInstance.close($scope.exerciseType);
          }

          $scope.onOkayClicked = function () {
            usSpinnerService.spin('exercise-upload-spinner');
            $scope.exerciseType.$save(closeDialogWithResult, showUploadExerciseTypeError);
          };

          $scope.onCancelClicked = function () {
            $modalInstance.dismiss();
          };
        }
      ]
    });
  };
}]);