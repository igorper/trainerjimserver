var exerciseTypeDetailsModule = angular.module("exerciseTypes.exerciseTypeDetails", [
  'exerciseTypes.exerciseType',
  'users.exerciseTypes.photos',
  'photos.photoThumb'
]);

exerciseTypeDetailsModule.directive('exerciseTypeDetails', function () {
  return {
    restrict: 'E',
    scope: {
      'exerciseTypeId': '=',
      'userId': '='
    },
    controller: ['$scope', 'ExerciseType', 'UserExerciseTypePhotos', 'Auth', function ($scope, ExerciseType, UserExerciseTypePhotos, Auth) {
      $scope.currentUser = Auth.userDetails();

      function refreshPhotos() {
        $scope.userPhotos = UserExerciseTypePhotos.query({
          userId: $scope.userId,
          exerciseTypeId: $scope.exerciseTypeId
        });
      }

      refreshPhotos();

      $scope.canDeletePhoto = function (photo) {
        return photo.user_id == $scope.userId || photo.user_id == $scope.currentUser.id;
      };

      $scope.onDeletePhotoClicked = function (photo) {
        photo.$delete().then(refreshPhotos);
      };
    }],
    templateUrl: "<%= asset_path('exerciseTypes/exercise-type-details.html') %>"
  };
});


exerciseTypeDetailsModule.factory('ExerciseTypeDetailsDialog', ['$modal', function ($modal) {
  return function (exerciseTypeId) {
    return $modal.open({
      templateUrl: '<%= asset_path('exerciseTypes/exercise-type-details-dialog.html') %>',
      backdrop: 'static',
      windowClass: 'modal-window',
      size: 'lg',
      controller: ['$scope', 'ExerciseType', function ($scope, ExerciseType) {
          $scope.exerciseTypeId = exerciseTypeId;

          $scope.onCloseClicked = function () {
            $scope.$dismiss();
          };
        }
      ]
    });
  };
}]);