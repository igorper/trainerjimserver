//= require angular/angular
//= require angular-ui-select/dist/select
//= require trainings/training
//= require angularjs-toaster/toaster

var workoutsSelector = angular.module('workouts.selector', [
  'ui.select',
  'trainings',
  'toaster',
  'util.propsFilter'
]);

workoutsSelector.factory('WorkoutSelector', ['$modal', function ($modal) {
  return function () {
    return $modal.open({
      templateUrl: '<%= asset_path('workouts/selector/workout-selector.html') %>',
      controller: 'WorkoutSelectorCtrl',
      backdrop: 'static',
      windowClass: 'modal-window'
    });
  };
}]);

workoutsSelector.controller("WorkoutSelectorCtrl", ["$scope", '$modalInstance', 'Training', 'toaster',
  function ($scope, $modalInstance, Training, toaster) {
    $scope.trainings = [];
    $scope.selectedTraining = {};

    $scope.ok = function () {
      if ($scope.selectedTraining.selected == undefined) {
        toaster.pop("warning", "Please select a workout.");
      } else {
        $modalInstance.close($scope.selectedTraining.selected);
      }
    };

    $scope.cancel = function () {
      $modalInstance.dismiss();
    };

    Training.query(function (data) {
      $scope.trainings = data;
    }, function (data, status, headers) {
      toaster.pop("error", "Could not fetch the list of workouts. Try logging in.");
    });
  }
]);