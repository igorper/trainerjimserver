//= require exerciseTypes/exerciseTypeEditDialog

var admin = angular.module('admin.exerciseTypes', [
  'ui.router',
  'exerciseTypes.exerciseType',
  'exerciseTypes.exerciseTypeEditDialog',
  'exerciseTypes.exerciseTypeDetails'
]);

admin.config(['$stateProvider', function ($stateProvider) {
    $stateProvider
      .state('main.admin.exerciseTypes', {
        url: '/exerciseTypes',
        templateUrl: "<%= asset_path('admin/admin-exercise-types.html') %>",
        controller: ['$scope', 'ExerciseType', 'ExerciseTypeEditDialog', 'ExerciseTypeDetailsDialog', 'toaster', function ($scope, ExerciseType, ExerciseTypeEditDialog, ExerciseTypeDetailsDialog, toaster) {
          function refreshExerciseTypes() {
            $scope.exerciseTypes = ExerciseType.query();
          }

          refreshExerciseTypes();

          $scope.onCreateExerciseTypeClicked = function () {
            var loginDialog = ExerciseTypeEditDialog().result.then(function (exerciseType) {
              ExerciseType.upload(exerciseType)
                .success(refreshExerciseTypes);
            });
          };

          $scope.onExerciseClicked = function (exerciseType) {
            ExerciseTypeDetailsDialog(exerciseType);
          };

          $scope.onEditExerciseClicked = function (exerciseType) {
            ExerciseTypeEditDialog(exerciseType).result.then(function (editedExercise) {
              ExerciseType.upload(editedExercise, refreshExerciseTypes)
                .success(refreshExerciseTypes);
            });
          };

          $scope.onDeleteExerciseClicked = function (exerciseType) {
            ExerciseType.delete({id: exerciseType.id}, refreshExerciseTypes, function (errorData) {
              toaster.pop("error", "Exercise type not deleted", "Could not delete the exercise type. The exercise type is in use.");
            });
          };
        }]
      })
    ;
  }])
;