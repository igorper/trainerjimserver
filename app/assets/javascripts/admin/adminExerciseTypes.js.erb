//= require exerciseTypes/exerciseTypeEditDialog

var admin = angular.module('admin.exerciseTypes', [
  'ui.router',
  'exerciseTypes.exerciseType',
  'exerciseTypes.exerciseTypeEditDialog',
  'exerciseTypes.exerciseTypeDetails'
]);

admin.config(['$stateProvider', function ($stateProvider) {
  $stateProvider
    .state('main.admin.exerciseTypes', {
      url: '/exerciseTypes',
      templateUrl: "<%= asset_path('admin/admin-exercise-types.html') %>",
      controller: ['$scope', 'ExerciseType', 'ExerciseTypeEditDialog', 'ExerciseTypeDetailsDialog', 'toaster', function ($scope, ExerciseType, ExerciseTypeEditDialog, ExerciseTypeDetailsDialog, toaster) {

        function refreshExerciseTypes() {
          $scope.exerciseTypes = ExerciseType.query();
        }

        refreshExerciseTypes();

        function showUploadExerciseTypeError() {
          toaster.pop("error", "Exercise type not uploaded", "An error occurred while uploading the exercise type.");
        }

        function uploadExerciseType(exerciseType) {
          return ExerciseType
            .upload(exerciseType)
            .success(refreshExerciseTypes)
            .error(showUploadExerciseTypeError);
        }

        $scope.onCreateExerciseTypeClicked = function () {
          ExerciseTypeEditDialog({uploadPromise: uploadExerciseType});
        };

        $scope.onExerciseClicked = ExerciseTypeDetailsDialog;

        $scope.onEditExerciseClicked = function (exerciseType) {
          ExerciseTypeEditDialog({exerciseType: exerciseType, uploadPromise: uploadExerciseType});
        };

        $scope.onDeleteExerciseClicked = function (exerciseType) {
          ExerciseType.delete({id: exerciseType.id}, refreshExerciseTypes, function (errorData) {
            toaster.pop("error", "Exercise type not deleted", "Could not delete the exercise type. The exercise type is in use.");
          });
        };
      }]
    })
  ;
}])
;