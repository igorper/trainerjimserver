//= require auth/auth

angular.module('shared', [
  'auth',
  'ui.router',
  'util.filters.isShown',
  'util.links'
])
  .directive('header', function () {
    return {
      restrict: 'E',
      controller: 'HeaderCtrl',
      templateUrl: '<%= asset_path('shared/header-nav-bar.html') %>'
    }
  })
  .controller('HeaderCtrl', ['$scope', '$state', 'Auth', 'isLinkActive', function ($scope, $state, Auth, isLinkActive) {
    $scope.topNavigation = [
      {
        name: "Workouts",
        link: "main.workouts"
      },
      {
        name: "Trainees",
        link: "main.trainees",
        activeUrls: ["main.trainee"],
        isShown: function () {
          return $scope.userDetails && $scope.userDetails.is_trainer;
        }
      },
      {
        name: "Results",
        link: "main.results"
      },
      {
        name: "Administration",
        link: "main.admin.exerciseTypes",
        isShown: function () {
          return $scope.userDetails && ($scope.userDetails.is_admin || $scope.userDetails.is_trainer);
        }
      }
    ];

    $scope.isLinkActive = isLinkActive;

    function updateUserDetails(userDetails) {
      $scope.userDetails = userDetails;
    }

    $scope.$on(USER_CHANGED_EVENT, function (event, updatedUser) {
      updateUserDetails(updatedUser);
    });

    Auth.userDetails(updateUserDetails);

    $scope.logout = function () {
      Auth.logout(function () {
        $state.go('welcome');
      });
    };
  }])
  .directive('footer', function () {
    return {
      restrict: 'E',
      controller: 'FooterCtrl',
      templateUrl: '<%= asset_path('shared/footer-bar.html') %>'
    }
  })
  .controller('FooterCtrl', ['$scope', function ($scope) {

  }]);

